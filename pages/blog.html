<!DOCTYPE html>

<body>
    <ul id="chat" style="list-style-type: none;"></ul>

    <form onsubmit="writeChat()">
        <input type="text" id="message">
        <input type="submit" value="send">
    </form>

    <script type="text/javascript">
        readChat()

        async function readChat() {
            fetch('https://uncleleo037.github.io/chat.json')
                .then((res) => res.json())
                .then((data) => {
                    data.forEach(msg => {
                        let message = document.createElement('li')
                        message.appendChild(document.createTextNode(msg.contents))
                        document.getElementById("chat").appendChild(message)
                    })
                })
                .catch(error => console.error("Unable to connect to chat", error))
        }

        function writeChat() {
            let message = document.getElementById("message")
            const temp = {
                sender: "anon",
                contents: message.value.trim()
            }

            fetch('https://uncleleo037.github.io/chat.json', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(temp)
            })
                .then(response => response.json())
                .then(() => {
                    readChat();
                    message.value = '';
                })
                .catch(error => console.error('Unable to send message', error));
        }
    </script>

</body>

</html>